// Name: Blogger Live Search Plugin
// Author: Việt Designer
// Website: www.thietkeblogspot.com
if("undefined"!=typeof jQuery&&document.getElementById("search_settings"))if("true"!=live_search_settings.visible&&"false"!=live_search_settings.visible)alert("Bạn phải cài đặt giá trị true hoặc false");else if("true"==live_search_settings.visible){var typingTimer;function live_search(e){clearTimeout(typingTimer);var s=$(this),t=s.parent().parent(),i=t.find(".bg_sl"),r=t.find(".results");function a(){typingTimer=setTimeout(function(){var e=s.val(),t=e.replace(/ /gi,"+");if(i.length)var a=i.val();""!=e?(s.parent().find(".bg_su").addClass("searching"),$.ajax({type:"GET",url:live_search_settings.homepageUrl+"/feeds/posts/default",data:{alt:"json","max-results":0},dataType:"jsonp",success:function(e){var i,n,l=e.feed.openSearch$totalResults.$t;if(l%150==0)var c=l/150-1;else c=Math.floor(l/150);i=jQuery,n=i({}),i.ajaxQueue=function(e){function s(s){i.ajax(e).done(t.resolve).fail(t.reject).then(s,s)}var t=i.Deferred(),r=t.promise();return n.queue(s),r.abort=function(a){var l=n.queue(),c=i.inArray(s,l);return c>-1&&l.splice(c,1),t.rejectWith(e.context||e,[r,a,""]),r},r};for(var d=0;d<=c;d++)$.ajaxQueue({type:"GET",url:live_search_settings.homepageUrl+"/feeds/posts/default",data:{q:t,alt:"json","start-index":150*d+1,"max-results":150},dataType:"jsonp",success:function(e){if(s.parent().parent().find(".bg_co,.bg_re").removeClass("hidden"),s.parent().parent().find(".results").empty(),e.feed.entry)for(var t=0;t<e.feed.entry.length;t++){for(var i=e.feed.entry[t],n=t+1,l="",c=0;c<i.link.length;c++)if("alternate"==i.link[c].rel){var d=i.link[c].href;break}if("media$thumbnail"in i)var f=i.media$thumbnail.url.replace("s72-c","s50-c");else{var g=i.content.$t,o=g.indexOf("<img"),u=g.indexOf('src="',o),h=g.indexOf('"',u+5),v=g.substr(u+5,h-u-5);f=-1!=o&&-1!=u&&-1!=h&&""!=v?v:live_search_settings.thumbUrl}var _=i.title.$t;if("category"in i)for(var p="",m=0;m<i.category.length;m++){p+=i.category[m].term;var b=i.category[0].term;function y(){l="<li data-index="+n+'><a class="bg_fo" href='+d+' title="'+_+'"><div class="searching_img"><img alt="'+_+'" src='+f+'></div><div class="searching_title">'+_+'</div><div class="searching_cate">'+b+"</div></a></li>"}if(a&&""!=a)-1!=p.indexOf(a)&&y();else if(""!=live_search_settings.filter){var x=p.indexOf(live_search_settings.filter);p.slice(x,Number(x)+live_search_settings.filter.length)!=live_search_settings.filter&&y()}else y()}else r='<li class="no_results">'+live_search_settings.noresults+"</li>";$(r).append(l),$(".searching").removeClass("searching")}else $(".searching").removeClass("searching"),$(r).html('<li class="no_results">'+live_search_settings.noresults+"</li>")}})}})):(s.parent().parent().find(".bg_co,.bg_re").addClass("hidden"),$(".searching").removeClass("searching"))},500)}s.parent().find(".bg_re").removeClass("hidden"),a(),i.on("change",a)}$(".bg_se .bg_in").on("keyup",live_search),$(".bg_se .bg_re").click(function(){$(this).addClass("hidden"),$(".bg_co").addClass("hidden"),$(".bg_co>.bg_ra ul").empty()})}
